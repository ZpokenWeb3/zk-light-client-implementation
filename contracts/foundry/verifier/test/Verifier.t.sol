// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Test.sol";
import "../src/Verifier.sol";

contract VerifierTest is Test {
    Verifier public verifier;

    uint256[4] public inputs;
    uint256[8] public proof;
    uint256[4] public incorrectInputs;
    uint256[8] public incorrectProof;

    function setUp() public {
        verifier = new Verifier();

        inputs = [
            946114226032418920967126594582827844,
            252211404666022190610388135805056990747,
            250203699874957393754930603326313200955,
            294168951901226811933587358204780889671
        ];

        proof = [
            6302162678823841200396915311228777342524310647178952242621209430860606417875,
            5688874101604422809062392686067769974466336383547871872297604857481113209311,
            13067201362306888280420276685585448577630319898210624528091944232563639673903,
            15253040417767205464665745126190612115773771949281934081886164082116687122186,
            1286287796680172736180296629792415589426353119726353867523801064677953938381,
            10072443203863058952492408939658944706911871289381911835060263441184101246878,
            13594152181780533529094098669508003919098231319348108349232488431856536079741,
            19991156839958621917471713965247457880542796239191147501866226782529365125613
        ];

        incorrectInputs = [
            946114226032418920967126594582827840,
            252211404666022190610388135805056990740,
            250203699874957393754930603326313200950,
            294168951901226811933587358204780889670
        ];

        incorrectProof = [
            6302162678823841200396915311228777342524310647178952242621209430860606417870,
            5688874101604422809062392686067769974466336383547871872297604857481113209310,
            13067201362306888280420276685585448577630319898210624528091944232563639673900,
            15253040417767205464665745126190612115773771949281934081886164082116687122180,
            1286287796680172736180296629792415589426353119726353867523801064677953938380,
            10072443203863058952492408939658944706911871289381911835060263441184101246870,
            13594152181780533529094098669508003919098231319348108349232488431856536079740,
            19991156839958621917471713965247457880542796239191147501866226782529365125610
        ];
    }

    function testSuccessfulVerifyProof() public view {
        verifier.verifyProof(proof, inputs);
    }

    function testSuccessfulVerifyCompressedProof() public view {
        uint256[4] memory compressedProof = verifier.compressProof(proof);
        verifier.verifyCompressedProof(compressedProof, inputs);
    }

    function testIncorrectProof() public {
        vm.expectRevert(Verifier.ProofInvalid.selector);
        verifier.verifyProof(proof, incorrectInputs);

        vm.expectRevert(Verifier.ProofInvalid.selector);
        verifier.verifyProof(incorrectProof, inputs);
    }
}
